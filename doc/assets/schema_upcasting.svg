<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 350">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <linearGradient id="v1Grad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9CA3AF;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6B7280;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="v2Grad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#60A5FA;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="v3Grad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#34D399;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#10B981;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="upcastGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
  </defs>

  <style>
    .title { font: bold 16px sans-serif; fill: #1F2937; }
    .version { font: bold 12px sans-serif; fill: white; }
    .field { font: 11px monospace; fill: #374151; }
    .arrow-label { font: 10px sans-serif; fill: #6B7280; }
    .box-title { font: bold 11px sans-serif; fill: #1F2937; }
  </style>

  <!-- Background -->
  <rect width="800" height="350" fill="#F9FAFB"/>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" class="title">Schema Evolution with Automatic Upcasting</text>

  <!-- Schema V1 -->
  <g transform="translate(50, 60)">
    <rect width="180" height="120" rx="8" fill="white" stroke="#9CA3AF" stroke-width="2"/>
    <rect width="180" height="28" rx="8" fill="url(#v1Grad)"/>
    <rect y="28" width="180" height="1" fill="#E5E7EB"/>
    <text x="90" y="20" text-anchor="middle" class="version">UserCreated v1</text>
    <text x="15" y="55" class="field">name: string</text>
    <text x="15" y="75" class="field">email: string</text>
    <text x="15" y="95" class="field">created_at: timestamp</text>
  </g>

  <!-- Schema V2 -->
  <g transform="translate(310, 60)">
    <rect width="180" height="140" rx="8" fill="white" stroke="#3B82F6" stroke-width="2"/>
    <rect width="180" height="28" rx="8" fill="url(#v2Grad)"/>
    <rect y="28" width="180" height="1" fill="#E5E7EB"/>
    <text x="90" y="20" text-anchor="middle" class="version">UserCreated v2</text>
    <text x="15" y="55" class="field">name: string</text>
    <text x="15" y="75" class="field">email: string</text>
    <text x="15" y="95" class="field">created_at: timestamp</text>
    <text x="15" y="115" class="field" fill="#3B82F6">phone: string (new)</text>
  </g>

  <!-- Schema V3 (current) -->
  <g transform="translate(570, 60)">
    <rect width="180" height="160" rx="8" fill="white" stroke="#10B981" stroke-width="2"/>
    <rect width="180" height="28" rx="8" fill="url(#v3Grad)"/>
    <rect y="28" width="180" height="1" fill="#E5E7EB"/>
    <text x="90" y="20" text-anchor="middle" class="version">UserCreated v3 (current)</text>
    <text x="15" y="55" class="field">name: string</text>
    <text x="15" y="75" class="field">email: string</text>
    <text x="15" y="95" class="field">created_at: timestamp</text>
    <text x="15" y="115" class="field">phone: string</text>
    <text x="15" y="135" class="field" fill="#10B981">verified: boolean (new)</text>
  </g>

  <!-- Upcast arrows -->
  <line x1="230" y1="120" x2="305" y2="120" stroke="#F59E0B" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="267" y="110" text-anchor="middle" class="arrow-label">upcast_v1_v2</text>

  <line x1="490" y1="120" x2="565" y2="120" stroke="#F59E0B" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="527" y="110" text-anchor="middle" class="arrow-label">upcast_v2_v3</text>

  <!-- Upcast function box -->
  <g transform="translate(180, 250)">
    <rect width="440" height="80" rx="8" fill="#FFFBEB" stroke="#F59E0B" stroke-width="1"/>
    <text x="220" y="25" text-anchor="middle" class="box-title">Upcast Chain (automatic)</text>
    <text x="20" y="50" class="field">v1 -> v2: phone = undefined</text>
    <text x="20" y="70" class="field">v2 -> v3: verified = false</text>
    <text x="260" y="50" class="field">%% Old events read as v3</text>
    <text x="260" y="70" class="field">%% No migration needed</text>
  </g>
</svg>
